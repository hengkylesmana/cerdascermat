<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Cerdas Cermat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f3f4f6; /* text-gray-100 */
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        .team-buzzer {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            color: white;
            border: 2px solid transparent;
        }
        .team-buzzer:not(:disabled):hover {
            transform: scale(1.05);
            border-color: #facc15;
        }
        .team-buzzer:active {
            transform: scale(0.98);
        }
        .team-buzzer:disabled {
            cursor: not-allowed;
            filter: grayscale(80%);
            opacity: 0.5;
        }
        .glowing-border {
            animation: glowing 1.5s infinite;
        }
        @keyframes glowing {
            0% { box-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); }
            50% { box-shadow: 0 0 20px var(--glow-color), 0 0 30px var(--glow-color); }
            100% { box-shadow: 0 0 5px var(--glow-color), 0 0 10px var(--glow-color); }
        }
        .judge-light {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 15px 2px rgba(255,255,255,0.1);
        }
        .judge-light.off { background-color: #4b5563; } /* gray-600 */
        .judge-light.live { background-color: #22C55E; box-shadow: 0 0 20px #22C55E; } /* green-500 */
        .judge-light.answered { background-color: var(--team-color); box-shadow: 0 0 20px var(--team-color); }
        
        .flashing {
            animation: flash-animation 0.5s 3;
        }
        @keyframes flash-animation {
            0%, 100% { background-color: #1f2937; box-shadow: none; }
            50% { background-color: #facc15; box-shadow: 0 0 35px #facc15; }
        }
    </style>
</head>
<body class="relative">
    <!-- Team C (Top Left) -->
    <div id="team-C-display" class="absolute top-4 left-4 p-4 rounded-2xl bg-gray-800 w-64" style="--glow-color: #f97316;">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-2xl font-bold text-amber-400">Regu C</h2>
            <p class="text-3xl font-black text-white" id="score-C">0</p>
        </div>
        <button id="buzzer-C" data-team="C" class="team-buzzer w-full py-4 text-xl font-bold uppercase bg-orange-700 hover:bg-orange-800 rounded-lg" disabled>Tekan</button>
    </div>

    <!-- Team D (Top Right) -->
    <div id="team-D-display" class="absolute top-4 right-4 p-4 rounded-2xl bg-gray-800 w-64" style="--glow-color: #eab308;">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-2xl font-bold text-amber-400">Regu D</h2>
            <p class="text-3xl font-black text-white" id="score-D">0</p>
        </div>
        <button id="buzzer-D" data-team="D" class="team-buzzer w-full py-4 text-xl font-bold uppercase bg-yellow-600 hover:bg-yellow-700 rounded-lg" disabled>Tekan</button>
    </div>

    <!-- Judge's Area (Center) -->
    <div class="w-full h-full flex items-center justify-center">
        <div id="judge-area" class="text-center p-6 bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl">
            <div class="flex items-center justify-center mb-4 gap-4">
                <div id="judge-light" class="judge-light off"></div>
                <h1 class="text-3xl md:text-4xl font-black tracking-wider uppercase text-amber-400">Cerdas Cermat</h1>
                <div id="question-counter" class="text-xl font-bold bg-orange-600 text-white px-3 py-1 rounded-lg">Babak 1</div>
            </div>
            <div id="question-box" class="min-h-[120px] bg-black rounded-xl p-4 flex items-center justify-center text-center">
                <p id="question-text" class="text-xl md:text-2xl font-semibold text-white">Selamat datang! Tekan "Mulai Permainan" untuk memulai.</p>
            </div>
            <div id="answer-feedback" class="mt-4 h-10 text-lg font-semibold text-amber-500"></div>
        </div>
    </div>

    <!-- Team B (Bottom Left) -->
    <div id="team-B-display" class="absolute bottom-4 left-4 p-4 rounded-2xl bg-gray-800 w-64" style="--glow-color: #facc15;">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-2xl font-bold text-amber-400">Regu B</h2>
            <p class="text-3xl font-black text-white" id="score-B">0</p>
        </div>
        <button id="buzzer-B" data-team="B" class="team-buzzer w-full py-4 text-xl font-bold uppercase bg-yellow-500 hover:bg-yellow-600 rounded-lg" disabled>Tekan</button>
    </div>

    <!-- Team A (Bottom Right) -->
    <div id="team-A-display" class="absolute bottom-4 right-4 p-4 rounded-2xl bg-gray-800 w-64" style="--glow-color: #f59e0b;">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-2xl font-bold text-amber-400">Regu A</h2>
            <p class="text-3xl font-black text-white" id="score-A">0</p>
        </div>
        <button id="buzzer-A" data-team="A" class="team-buzzer w-full py-4 text-xl font-bold uppercase bg-orange-600 hover:bg-orange-700 rounded-lg" disabled>Tekan</button>
    </div>
    
    <!-- Start Game Button (Positioned at the bottom) -->
    <div id="start-game-container" class="absolute inset-x-0 bottom-20 flex justify-center">
        <button id="start-game-btn" class="px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white font-bold text-xl rounded-lg shadow-lg transition-transform transform hover:scale-105">Mulai Permainan</button>
    </div>

    <!-- Modal for Final Score -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl text-center w-11/12 max-w-md">
            <h2 id="modal-title" class="text-3xl font-black mb-4 text-amber-400">Permainan Selesai!</h2>
            <p id="modal-winner" class="text-2xl font-bold text-orange-500 mb-6"></p>
            <div id="final-scores" class="space-y-2 text-lg"></div>
            <button id="restart-game-btn" class="mt-8 px-8 py-3 bg-orange-600 hover:bg-orange-700 text-white font-bold text-xl rounded-lg shadow-lg">Main Lagi</button>
        </div>
    </div>

    <script>
        // --- DOM ELEMENTS ---
        const questionText = document.getElementById('question-text');
        const judgeLight = document.getElementById('judge-light');
        const questionCounter = document.getElementById('question-counter');
        const answerFeedback = document.getElementById('answer-feedback');
        const startGameBtn = document.getElementById('start-game-btn');
        const startGameContainer = document.getElementById('start-game-container');
        const restartGameBtn = document.getElementById('restart-game-btn');
        const modal = document.getElementById('modal');
        const buzzers = document.querySelectorAll('.team-buzzer');
        
        // --- GAME STATE ---
        let scores = { A: 0, B: 0, C: 0, D: 0 };
        let currentQuestionIndex = 0;
        const QUESTIONS_PER_ROUND = 5;
        const TOTAL_QUESTIONS = QUESTIONS_PER_ROUND * 3;
        let questions = [];
        let isQuestionActive = false;
        let buzzerWinner = null;
        let questionTimeout;
        
        // --- WEB APIS & SOUND ---
        let synth, tickSynth, victorySynth;
        let indonesianVoice;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let tickEvent, victorySequence;

        // --- TEAM COLORS ---
        const teamColors = { A: '#f59e0b', B: '#facc15', C: '#f97316', D: '#eab308' };

        // --- CONTENT ---
        const questionBankEasy = [ { q: "Apa ibukota Indonesia?", a: "Jakarta" }, { q: "Berapa jumlah sila dalam Pancasila?", a: "Lima" }, { q: "Hewan yang bisa terbang adalah...", a: "Burung" }, { q: "Warna bendera Indonesia adalah...", a: "Merah Putih" }, { q: "Berapakah 2 ditambah 3?", a: "5" }, ];
        const questionBankMedium = [ { q: "Siapakah yang menjahit bendera pusaka Indonesia?", a: "Fatmawati" }, { q: "Planet manakah yang dikenal sebagai Planet Merah?", a: "Mars" }, { q: "Apa nama candi Buddha terbesar di dunia yang terletak di Indonesia?", a: "Borobudur" }, { q: "Berapakah hasil dari 12 dikali 12?", a: "144" }, { q: "Proses tumbuhan membuat makanan sendiri disebut...", a: "Fotosintesis" }, ];
        const questionBankHard = [ { q: "Apa nama perjanjian yang mengakhiri Perang Dunia Pertama?", a: "Perjanjian Versailles" }, { q: "Unsur kimia apa yang memiliki simbol 'Fe'?", a: "Besi" }, { q: "Siapakah penulis novel 'Laskar Pelangi'?", a: "Andrea Hirata" }, { q: "Dalam ekonomi, apa yang dimaksud dengan PDB?", a: "Produk Domestik Bruto" }, { q: "Apa nama selat yang memisahkan pulau Jawa dan Sumatra?", a: "Selat Sunda" }, ];
        const praisePhrases = ["BENAR! 100 POIN!", "Tepat sekali!", "Luar biasa!", "WOW! Keren banget!", "Jawaban sempurna!", "Singkat, padat, dan BENAR!", "ASTAGA! Tepat sasaran!", "Seperti yang diharapkan dari sang juara!"];
        const getReadyPhrases = ["Pertanyaan berikutnya...", "Siap-siap semuanya!", "Oke, fokus! Ini dia soalnya.", "Dengarkan baik-baik.", "Soal selanjutnya, siap?", "Konsentrasi penuh!"];
        const roundTransitionPhrases = [ "Babak pertama selesai! Kita masuk ke babak kedua dengan soal yang lebih menantang!", "Babak kedua berakhir! Selamat datang di babak penentuan! Siapkan diri kalian!" ];
        const victoryPhrases = [ "Juara sejati telah lahir! Kemenangan yang spektakuler!", "Selamat! Anda adalah pemenang cerdas cermat kali ini! Sungguh sebuah pencapaian yang membanggakan!", "Luar biasa! Tidak ada yang bisa menghentikanmu! Selamat atas kemenangannya!", "Kemenangan yang akan tercatat dalam sejarah! Selamat untuk sang juara!" ];

        // --- INITIALIZATION ---
        window.onload = () => {
            synth = new Tone.Synth().toDestination();
            tickSynth = new Tone.MembraneSynth({ pitchDecay: 0.01, octaves: 2, envelope: { attack: 0.001, decay: 0.2, sustain: 0 } }).toDestination();
            tickSynth.volume.value = -12;
            victorySynth = new Tone.PolySynth(Tone.Synth, { envelope: { attack: 0.02, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination();
            victorySynth.volume.value = -6;
            
            setupVoice();
            if (window.speechSynthesis.onvoiceschanged !== undefined) {
                window.speechSynthesis.onvoiceschanged = setupVoice;
            }
            setupSpeechRecognition();
        };

        function setupVoice() {
            const voices = window.speechSynthesis.getVoices();
            indonesianVoice = voices.find(voice => voice.lang === 'id-ID') || voices.find(voice => voice.default);
        }

        function setupSpeechRecognition() {
            if (!SpeechRecognition) {
                console.error("Speech Recognition tidak didukung di browser ini.");
                return;
            }
            recognition = new SpeechRecognition();
            recognition.lang = 'id-ID';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            recognition.onresult = (event) => {
                const spokenAnswer = event.results[0][0].transcript;
                answerFeedback.innerHTML = `Jawaban Anda: <span class="font-bold text-amber-500">${spokenAnswer}</span>`;
                checkAnswer(spokenAnswer);
            };
            recognition.onerror = (event) => {
                answerFeedback.textContent = "Maaf, saya tidak bisa mendengar jawaban Anda.";
                handleIncorrectAnswer();
            };
        }

        // --- SOUND FUNCTIONS ---
        function startTickingSound() {
            stopTickingSound();
            tickEvent = Tone.Transport.scheduleRepeat(time => {
                tickSynth.triggerAttackRelease("C2", "8n", time);
            }, "1s");
            Tone.Transport.start();
        }

        function stopTickingSound() {
            if (tickEvent) {
                Tone.Transport.clear(tickEvent);
                tickEvent = null;
            }
            Tone.Transport.stop();
        }

        function playVictorySound() {
            const now = Tone.now();
            victorySynth.triggerAttackRelease(["C4", "E4", "G4"], "8n", now);
            victorySynth.triggerAttackRelease(["G4", "B4", "D5"], "8n", now + 0.2);
            victorySynth.triggerAttackRelease(["C5", "E5", "G5"], "4n", now + 0.4);
        }

        // --- GAME LOGIC FUNCTIONS ---
        function speak(text, callback) {
            if (!window.speechSynthesis || !indonesianVoice) {
                if (callback) setTimeout(callback, 500);
                return;
            }
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = indonesianVoice;
            utterance.lang = 'id-ID';
            utterance.rate = 1;
            utterance.pitch = 1.1;
            utterance.onend = callback;
            window.speechSynthesis.speak(utterance);
        }

        function shuffleAndPickQuestions() {
            const easy = [...questionBankEasy].sort(() => 0.5 - Math.random()).slice(0, QUESTIONS_PER_ROUND);
            const medium = [...questionBankMedium].sort(() => 0.5 - Math.random()).slice(0, QUESTIONS_PER_ROUND);
            const hard = [...questionBankHard].sort(() => 0.5 - Math.random()).slice(0, QUESTIONS_PER_ROUND);
            questions = [...easy, ...medium, ...hard];
        }

        function startGame() {
            shuffleAndPickQuestions();
            scores = { A: 0, B: 0, C: 0, D: 0 };
            currentQuestionIndex = 0;
            buzzerWinner = null;
            modal.classList.add('hidden');
            startGameContainer.style.display = 'none';
            updateAllScores();
            nextQuestion();
        }

        function proceedToNextQuestion() {
            const question = questions[currentQuestionIndex];
            const currentRound = Math.floor(currentQuestionIndex / QUESTIONS_PER_ROUND) + 1;
            const questionInRound = (currentQuestionIndex % QUESTIONS_PER_ROUND) + 1;
            questionCounter.textContent = `Babak ${currentRound} - Soal ${questionInRound}`;
            
            const readyPhrase = getReadyPhrases[Math.floor(Math.random() * getReadyPhrases.length)];
            speak(readyPhrase, () => {
                questionText.textContent = "Juri akan membacakan pertanyaan...";
                speak(question.q, () => {
                    questionText.textContent = question.q;
                    isQuestionActive = true;
                    judgeLight.className = 'judge-light live';
                    enableAllBuzzers();
                    startTickingSound();
                    questionTimeout = setTimeout(handleNoAnswer, 10000);
                });
            });
        }

        function nextQuestion() {
            if (currentQuestionIndex >= TOTAL_QUESTIONS) {
                endGame();
                return;
            }
            resetRound();
            if (currentQuestionIndex === QUESTIONS_PER_ROUND) {
                speak(roundTransitionPhrases[0], proceedToNextQuestion);
            } else if (currentQuestionIndex === QUESTIONS_PER_ROUND * 2) {
                speak(roundTransitionPhrases[1], proceedToNextQuestion);
            } else {
                proceedToNextQuestion();
            }
        }
        
        function handleBuzzerPress(e) {
            if (!isQuestionActive) return;
            clearTimeout(questionTimeout);
            stopTickingSound();
            isQuestionActive = false;
            buzzerWinner = e.target.dataset.team;
            if (synth) synth.triggerAttackRelease("G5", "0.3s");
            disableAllBuzzers();
            highlightWinner(buzzerWinner);
            listenForAnswer();
        }
        
        function handleNoAnswer() {
            isQuestionActive = false;
            disableAllBuzzers();
            stopTickingSound();
            if (synth) synth.triggerAttackRelease("A2", "0.5s");
            questionText.textContent = "Waktu habis! Pertanyaan ini hangus.";
            setTimeout(() => {
                currentQuestionIndex++;
                nextQuestion();
            }, 3000);
        }

        function listenForAnswer() {
            questionText.textContent = `Regu ${buzzerWinner}, silakan menjawab...`;
            if(recognition) {
                recognition.start();
            } else {
                handleIncorrectAnswer();
            }
        }
        
        function checkAnswer(spokenAnswer) {
            const correctAnswer = questions[currentQuestionIndex].a;
            if (spokenAnswer.trim().toLowerCase() === correctAnswer.trim().toLowerCase()) {
                handleCorrectAnswer();
            } else {
                handleIncorrectAnswer();
            }
        }
        
        function handleCorrectAnswer() {
            scores[buzzerWinner] += 100;
            updateScore(buzzerWinner);
            const praise = praisePhrases[Math.floor(Math.random() * praisePhrases.length)];
            speak(praise);
            questionText.textContent = praise;
            judgeLight.classList.add('flashing');
            setTimeout(() => {
                currentQuestionIndex++;
                nextQuestion();
            }, 3500);
        }
        
        function handleIncorrectAnswer() {
            scores[buzzerWinner] -= 110;
            updateScore(buzzerWinner);
            if (synth) synth.triggerAttackRelease("A3", "0.5s");
            questionText.textContent = `Salah! (-110 Poin). Jawaban benar: ${questions[currentQuestionIndex].a}`;
            setTimeout(() => {
                currentQuestionIndex++;
                nextQuestion();
            }, 3500);
        }

        function endGame() {
            let winningTeam = '';
            const sortedScores = Object.entries(scores).sort(([,a],[,b]) => b-a);
            const highScore = sortedScores[0][1];
            let winnerName = "";

            if (highScore <= 0 && sortedScores.every(s => s[1] <= 0)) {
                 winningTeam = "Tidak ada pemenang kali ini.";
            } else {
                const winners = sortedScores.filter(([,score]) => score === highScore);
                winnerName = `Regu ${winners.map(([team]) => team).join(' & ')}`;
                const victoryMessage = victoryPhrases[Math.floor(Math.random() * victoryPhrases.length)];
                winningTeam = winners.length > 1 
                    ? `Hasil Seri! ${victoryMessage}`
                    : `${winnerName}, ${victoryMessage}`;
                playVictorySound();
            }
            
            speak(winningTeam);
            document.getElementById('modal-winner').textContent = winnerName;
            document.getElementById('modal-title').textContent = winningTeam;

            const finalScoresDiv = document.getElementById('final-scores');
            finalScoresDiv.innerHTML = sortedScores.map(([team, score]) => `
                <div class="flex justify-between items-center bg-gray-700 p-2 rounded-lg">
                    <span class="font-bold text-gray-200">Regu ${team}</span>
                    <span class="font-semibold text-amber-400">${score} Poin</span>
                </div>
            `).join('');
            modal.classList.remove('hidden');
        }

        // --- UI HELPER FUNCTIONS ---
        function resetRound() {
            isQuestionActive = false;
            buzzerWinner = null;
            judgeLight.className = 'judge-light off';
            judgeLight.classList.remove('flashing');
            answerFeedback.textContent = '';
            stopTickingSound();
            buzzers.forEach(b => {
                const teamId = b.dataset.team;
                document.getElementById(`team-${teamId}-display`).classList.remove('glowing-border');
            });
        }

        function updateScore(team) {
            const scoreElement = document.getElementById(`score-${team}`);
            scoreElement.textContent = scores[team];
            scoreElement.classList.remove('text-green-400', 'text-red-400', 'text-white');
            if (scores[team] > 0) {
                scoreElement.classList.add('text-green-400');
            } else if (scores[team] < 0) {
                scoreElement.classList.add('text-red-400');
            } else {
                 scoreElement.classList.add('text-white');
            }
        }

        function updateAllScores() {
            for (const team in scores) { updateScore(team); }
        }

        function enableAllBuzzers() {
            buzzers.forEach(b => b.disabled = false);
        }

        function disableAllBuzzers() {
            buzzers.forEach(b => b.disabled = true);
        }
        
        function highlightWinner(team) {
            const teamDisplay = document.getElementById(`team-${team}-display`);
            const teamColor = teamColors[team];
            teamDisplay.classList.add('glowing-border');
            teamDisplay.style.setProperty('--glow-color', teamColor);
            judgeLight.className = 'judge-light answered';
            judgeLight.style.setProperty('--team-color', teamColor);
        }

        // --- EVENT LISTENERS ---
        startGameBtn.addEventListener('click', startGame);
        restartGameBtn.addEventListener('click', () => {
            modal.classList.add('hidden');
            startGameContainer.style.display = 'flex';
        });
        buzzers.forEach(button => button.addEventListener('click', handleBuzzerPress));
    </script>
</body>
</html>
